<template>
  <section class="ym-playrate-tip" v-if="isHolding">
    <svg viewBox="0 0 111 66">
      <g transform="matrix(1,0,0,1,94.5,32.5)">
        <g transform="matrix(0,3,-3,0,0,0)">
          <path
            fill="#fff"
            d=" M6.138000011444092,3.5460000038146973 C6.4679999351501465,4.105999946594238 6.2779998779296875,4.826000213623047 5.7179999351501465,5.156000137329102 C5.538000106811523,5.265999794006348 5.3379998207092285,5.326000213623047 5.118000030517578,5.326000213623047 C5.118000030517578,5.326000213623047 -5.122000217437744,5.326000213623047 -5.122000217437744,5.326000213623047 C-5.771999835968018,5.326000213623047 -6.302000045776367,4.796000003814697 -6.302000045776367,4.145999908447266 C-6.302000045776367,3.936000108718872 -6.242000102996826,3.7260000705718994 -6.142000198364258,3.5460000038146973 C-6.142000198364258,3.5460000038146973 -1.3519999980926514,-4.553999900817871 -1.3519999980926514,-4.553999900817871 C-0.9120000004768372,-5.294000148773193 0.04800000041723251,-5.544000148773193 0.7979999780654907,-5.104000091552734 C1.027999997138977,-4.973999977111816 1.218000054359436,-4.783999919891357 1.3480000495910645,-4.553999900817871 C1.3480000495910645,-4.553999900817871 6.138000011444092,3.5460000038146973 6.138000011444092,3.5460000038146973z"
          ></path>
        </g>
      </g>

      <g transform="matrix(1,0,0,1,55.5,32.5)">
        <g transform="matrix(0,3,-3,0,0,0)">
          <path
            fill="#fff"
            d=" M6.138000011444092,3.5460000038146973 C6.4679999351501465,4.105999946594238 6.2779998779296875,4.826000213623047 5.7179999351501465,5.156000137329102 C5.538000106811523,5.265999794006348 5.3379998207092285,5.326000213623047 5.118000030517578,5.326000213623047 C5.118000030517578,5.326000213623047 -5.122000217437744,5.326000213623047 -5.122000217437744,5.326000213623047 C-5.771999835968018,5.326000213623047 -6.302000045776367,4.796000003814697 -6.302000045776367,4.145999908447266 C-6.302000045776367,3.936000108718872 -6.242000102996826,3.7260000705718994 -6.142000198364258,3.5460000038146973 C-6.142000198364258,3.5460000038146973 -1.3519999980926514,-4.553999900817871 -1.3519999980926514,-4.553999900817871 C-0.9120000004768372,-5.294000148773193 0.04800000041723251,-5.544000148773193 0.7979999780654907,-5.104000091552734 C1.027999997138977,-4.973999977111816 1.218000054359436,-4.783999919891357 1.3480000495910645,-4.553999900817871 C1.3480000495910645,-4.553999900817871 6.138000011444092,3.5460000038146973 6.138000011444092,3.5460000038146973z"
          ></path>
        </g>
      </g>

      <g transform="matrix(1,0,0,1,16.5,32.5)">
        <g transform="matrix(0,3,-3,0,0,0)">
          <path
            fill="#fff"
            d=" M6.138000011444092,3.5460000038146973 C6.4679999351501465,4.105999946594238 6.2779998779296875,4.826000213623047 5.7179999351501465,5.156000137329102 C5.538000106811523,5.265999794006348 5.3379998207092285,5.326000213623047 5.118000030517578,5.326000213623047 C5.118000030517578,5.326000213623047 -5.122000217437744,5.326000213623047 -5.122000217437744,5.326000213623047 C-5.771999835968018,5.326000213623047 -6.302000045776367,4.796000003814697 -6.302000045776367,4.145999908447266 C-6.302000045776367,3.936000108718872 -6.242000102996826,3.7260000705718994 -6.142000198364258,3.5460000038146973 C-6.142000198364258,3.5460000038146973 -1.3519999980926514,-4.553999900817871 -1.3519999980926514,-4.553999900817871 C-0.9120000004768372,-5.294000148773193 0.04800000041723251,-5.544000148773193 0.7979999780654907,-5.104000091552734 C1.027999997138977,-4.973999977111816 1.218000054359436,-4.783999919891357 1.3480000495910645,-4.553999900817871 C1.3480000495910645,-4.553999900817871 6.138000011444092,3.5460000038146973 6.138000011444092,3.5460000038146973z"
          ></path>
        </g>
      </g>
    </svg>
    <span class="fs-14">3倍速播放中</span>
  </section>
</template>

<script setup lang="ts">
import { playrate } from "@/stores/usePlayrate";
import { back, forward } from "@/stores/useTime";

let holdTimeout: number;

//是否按下右方向键
const isHolding = ref(false);

//键盘按下事件
const handleKeyDown = (e: KeyboardEvent) => {
  switch (e.key) {
    case "ArrowRight":
      if (isHolding.value) {
        return;
      }

      holdTimeout = setTimeout(() => {
        isHolding.value = true;
        playrate.value = 3;
      }, 300);
      return;
  }
};

//键盘抬起事件
const handleKeyUp = (e: KeyboardEvent) => {
  switch (e.key) {
    case "ArrowRight":
      clearTimeout(holdTimeout);

      if (isHolding.value) {
        isHolding.value = false;
        playrate.value = 1;
        return;
      }

      forward();
      return;
    case "ArrowLeft":
      back();
      return;
  }
};

onMounted(() => {
  window.addEventListener("keydown", handleKeyDown);
  window.addEventListener("keyup", handleKeyUp);
});

onUnmounted(() => {
  window.removeEventListener("keydown", handleKeyDown);
  window.removeEventListener("keyup", handleKeyUp);
});
</script>

<style scoped lang="scss">
.ym-playrate-tip {
  padding: 0.5rem 0.8rem;

  display: flex;
  align-items: center;
  gap: 0.5rem;

  position: absolute;
  top: 5%;
  left: 50%;

  transform: translateX(-50%);
  border-radius: 0.5rem;
  background-color: #272727;
  border: 1px solid #191919;

  > svg {
    width: 30px;
    > g {
      opacity: 0.2;
      animation: o 1s infinite;
    }

    > g:nth-child(1) {
      animation-delay: 0.4s;
    }

    > g:nth-child(2) {
      animation-delay: 0.2s;
    }

    > g:nth-child(3) {
      animation-delay: 0s;
    }
  }

  > span {
    color: #fff;
  }

  @keyframes o {
    0% {
      opacity: 0.2;
    }
    50% {
      opacity: 0.8;
    }
    100% {
      opacity: 0.2;
    }
  }
}
</style>
